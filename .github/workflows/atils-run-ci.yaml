name: CI Build and Publish

on:
  push:
    branches:
      - master
    paths:
      - 'atils/**'

jobs:
  build-and-publish:
    runs-on: ubuntu-latest
    container:
      image: aidanhilt/atils-ci:latest
      volumes:
        - /var/run/docker.sock:/var/run/docker.sock

    steps:
    - name: Login to Docker Hub
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKERHUB_USERNAME }}
        password: ${{ secrets.DOCKERHUB_TOKEN }}
    - name: Checkout code
      uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Build and publish
      run: |
<<<<<<< HEAD
        atils build --build-directory "atils" --action-set ci-build-publish
      env:
        PYPI_AUTH_TOKEN: ${{ secrets.ATILS_PYPI_TOKEN }}
=======
        atils build --build-directory "atils" --action-set ci-build-publish
>>>>>>> 8f50e73e364e6c516c43eba671bbf24ebcc5efaa
