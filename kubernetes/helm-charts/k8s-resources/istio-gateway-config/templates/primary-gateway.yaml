apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: internal-gateway
  namespace: istio-system
spec:
  servers:
    - port:
        number: 80
        name: http
        protocol: HTTP
      hosts:
        {{- toYaml .Values.hostnames | nindent 8 }}
        {{- if index .Values "hashi-vault" "enabled" }}
        {{- range .Values.hostnames }}
          {{- if not (regexMatch "^[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}$" .) }}
        - vault.{{ . }}
          {{- end }}
        {{- end }}
        {{- end }}
        {{- if index .Values "jellyseerr" "enabled" }}
        {{- range .Values.hostnames }}
          {{- if not (regexMatch "^[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}$" .) }}
        - jellyseerr.{{ . }}
          {{- end }}
        {{- end }}
        {{- end }}
