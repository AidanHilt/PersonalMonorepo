{{ if .Values.prometheus.enabled }}
apiVersion: v1
kind: Namespace
metadata:
  creationTimestamp: "2023-03-23T02:47:48Z"
  labels:
    kubernetes.io/metadata.name: monitoring
  name: monitoring
---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prometheus
  namespace: argocd
spec:
  project: default
  source:
    repoURL: 'https://github.com/prometheus-community/helm-charts.git'
    path: charts/kube-prometheus-stack
    targetRevision: e58a02bf1f7bc99b0c155c1b301b94534ed49b90
    helm:
      values: |
        grafana:
          env:
            {{ if ne .Values.env "dev-laptop" }}
            GF_SERVER_ROOT_URL: '%(protocol)s://%(domain)s:%(http_port)s/grafana/'
            GF_SERVE_FROM_SUB_PATH: false
            {{ end }}
        prometheus:
          prometheusSpec:
            serviceMonitorSelectorNilUsesHelmValues: false
  destination:
    server: 'https://kubernetes.default.svc'
    namespace: monitoring
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
{{end}}
