apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: jellyseerr-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$1
    nginx.ingress.kubernetes.io/configuration-snippet: |
      rewrite ^/jellyseerr/?(.*)$ /$1 break;
      proxy_set_header Accept-Encoding "";
      sub_filter_once off;
      sub_filter_types *;
      sub_filter 'href="/"' 'href="/jellyseerr"';
      sub_filter 'href="/login"' 'href="/jellyseerr/login"';
      sub_filter 'href:"/"' 'href:"/jellyseerr"';
      sub_filter '\/_next' '\/jellyseerr\/_next';
      sub_filter '/_next' '/jellyseerr/_next';
      sub_filter '/api/v1' '/jellyseerr/api/v1';
      sub_filter '/login/plex/loading' '/jellyseerr/login/plex/loading';
      sub_filter '/images/' '/jellyseerr/images/';
      sub_filter '/android-' '/jellyseerr/android-';
      sub_filter '/apple-' '/jellyseerr/apple-';
      sub_filter '/favicon' '/jellyseerr/favicon';
      sub_filter '/logo_' '/jellyseerr/logo_';
      sub_filter '/site.webmanifest' '/jellyseerr/site.webmanifest';
spec:
  rules:
    - http:
        paths:
          - path: /jellyseerr
            pathType: Prefix
            backend:
              service:
                name: jellyseerr
                port:
                  number: 80
